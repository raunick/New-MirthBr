{
  "version": "1.0",
  "name": "HL7 to JSON WORKFLOW",
  "channelName": "HL7 to JSON WORKFLOW",
  "channelId": "550e8400-e29b-41d4-a716-446655440101",
  "maxRetries": 3,
  "nodes": [
    {
      "id": "documentation-node",
      "type": "textNode",
      "position": {
        "x": -380,
        "y": -100
      },
      "data": {
        "label": "üìã Documenta√ß√£o do Workflow",
        "text": "## HL7 to JSON Workflow\n\n**Objetivo:** Converter mensagens HL7 v2.x para JSON, validar e enriquecer os dados.\n\n### Fluxo de Processamento:\n\n1. **HTTP Receiver** - Recebe mensagens HL7 via HTTP POST na porta 8080\n\n2. **HL7 Parser** - Converte a mensagem HL7 para formato JSON estruturado\n\n3. **Validador** - Valida campos obrigat√≥rios (PID-3, PID-5)\n\n4. **Enriquecimento** - Adiciona metadados do sistema\n\n5. **File Writer** - Salva o JSON no diret√≥rio de sa√≠da\n\n### Tipos de Mensagem Suportados:\n- ADT^A01 (Admiss√£o)\n- ADT^A02 (Transfer√™ncia)\n- ADT^A03 (Alta)",
        "isTemplate": false,
        "value": "Documenta√ß√£o"
      },
      "width": 320,
      "height": 450,
      "selected": false,
      "positionAbsolute": {
        "x": -380,
        "y": -100
      },
      "dragging": false
    },
    {
      "id": "test-node",
      "type": "testNode",
      "position": {
        "x": 958.3465161615462,
        "y": 440.38942978746
      },
      "data": {
        "label": "Test HL7 Message",
        "payloadType": "hl7",
        "payload": "MSH|^~\\&|HIS|HOSPITAL|MIRTHBR|ENGINE|202312140800||ADT^A01|MSG00001|P|2.3\nEVN|A01|202312140800\nPID|1||123456||SILVA^MARIA^LUIZA||19850315|F|||RUA DAS FLORES 123^^SAO PAULO^SP^01234567^BR||5511912345678\nPV1|1|I|UTI^101^A^HOSPITAL||||1234^ALMEIDA^CARLOS^EDUARDO^DR|||MED||||||||1234567890|||||||||||||202312140800",
        "sendMode": "http",
        "tcpHost": "localhost",
        "tcpPort": "6500",
        "tcpTimeout": "30"
      },
      "width": 300,
      "height": 510,
      "selected": false,
      "dragging": false,
      "positionAbsolute": {
        "x": 958.3465161615462,
        "y": 440.38942978746
      }
    },
    {
      "id": "source-http",
      "type": "httpListener",
      "position": {
        "x": 350,
        "y": 250
      },
      "data": {
        "label": "HTTP HL7 Receiver",
        "port": 8080,
        "path": "api/messages"
      },
      "width": 260,
      "height": 206
    },
    {
      "id": "proc-hl7-parser",
      "type": "hl7Parser",
      "position": {
        "x": 650,
        "y": 250
      },
      "data": {
        "label": "HL7 to JSON",
        "inputFormat": "hl7v2",
        "outputFormat": "json"
      },
      "width": 260,
      "height": 244
    },
    {
      "id": "proc-validator",
      "type": "luaScript",
      "position": {
        "x": 950,
        "y": 250
      },
      "data": {
        "label": "Validador de Dados",
        "code": "-- Valida√ß√£o de campos obrigat√≥rios\nlocal json = require('json')\nlocal data = json.decode(msg.content)\n\nlocal errors = {}\n\n-- Validar PID (Patient Identification)\nif not data.PID then\n    table.insert(errors, 'Segmento PID ausente')\nelse\n    if not data.PID[3] or data.PID[3] == '' then\n        table.insert(errors, 'ID do paciente (PID-3) √© obrigat√≥rio')\n    end\n    if not data.PID[5] or data.PID[5] == '' then\n        table.insert(errors, 'Nome do paciente (PID-5) √© obrigat√≥rio')\n    end\nend\n\nif #errors > 0 then\n    log.error('Valida√ß√£o falhou: ' .. table.concat(errors, '; '))\n    data['_validationErrors'] = errors\n    data['_isValid'] = false\nelse\n    log.info('Valida√ß√£o OK')\n    data['_isValid'] = true\nend\n\nreturn json.encode(data)"
      },
      "width": 260,
      "height": 160
    },
    {
      "id": "proc-enrich",
      "type": "luaScript",
      "position": {
        "x": 1250,
        "y": 250
      },
      "data": {
        "label": "Enriquecimento",
        "code": "-- Enriquecer dados com metadados do sistema\nlocal json = require('json')\nlocal data = json.decode(msg.content)\n\n-- Adicionar metadados de processamento\ndata['_metadata'] = {\n    processedAt = os.date('%Y-%m-%dT%H:%M:%SZ'),\n    processedBy = 'MirthBR Engine',\n    version = '1.0.0',\n    channelId = 'hl7-admission-complete'\n}\n\nlog.info('Dados enriquecidos com metadados')\n\nreturn json.encode(data)"
      },
      "width": 260,
      "height": 160
    },
    {
      "id": "dest-file",
      "type": "fileWriter",
      "position": {
        "x": 1550,
        "y": 250
      },
      "data": {
        "label": "Arquivo de Sa√≠da",
        "path": "./output/admissions",
        "filename": "${timestamp}_admission.json"
      },
      "width": 280,
      "height": 257
    },
    {
      "id": "node-1766008613292",
      "type": "textNode",
      "position": {
        "x": 336.1273701701384,
        "y": 527.5089173219467
      },
      "data": {
        "label": "Text",
        "text": "http://localhost:${porta}/${caminho}",
        "isTemplate": true,
        "value": "http://localhost:8080/api/messages"
      },
      "width": 260,
      "height": 318,
      "selected": false,
      "positionAbsolute": {
        "x": 336.1273701701384,
        "y": 527.5089173219467
      },
      "dragging": false
    },
    {
      "id": "node-1766008640939",
      "type": "textNode",
      "position": {
        "x": -320.8730107267398,
        "y": 292.65013720586296
      },
      "data": {
        "label": "porta",
        "text": "8080",
        "isTemplate": false,
        "value": "8080"
      },
      "width": 260,
      "height": 180,
      "selected": false,
      "positionAbsolute": {
        "x": -320.8730107267398,
        "y": 292.65013720586296
      },
      "dragging": false
    },
    {
      "id": "node-1766008650622",
      "type": "portNode",
      "position": {
        "x": 36.94284891961627,
        "y": 236.91768584320153
      },
      "data": {
        "label": "Port",
        "port": 8080,
        "protocol": "TCP"
      },
      "width": 200,
      "height": 169,
      "selected": false,
      "positionAbsolute": {
        "x": 36.94284891961627,
        "y": 236.91768584320153
      },
      "dragging": false
    },
    {
      "id": "node-1766008694638",
      "type": "textNode",
      "position": {
        "x": -348.19607393287913,
        "y": 552.9601997070182
      },
      "data": {
        "label": "caminho",
        "text": "api/messages",
        "isTemplate": false,
        "value": "api/messages"
      },
      "width": 260,
      "height": 269,
      "selected": false,
      "positionAbsolute": {
        "x": -348.19607393287913,
        "y": 552.9601997070182
      },
      "dragging": false
    },
    {
      "id": "node-1766008978068",
      "type": "commentNode",
      "position": {
        "x": 1273.6963529555155,
        "y": 464.7544534042331
      },
      "data": {
        "label": "Comment",
        "text": "MENSAGEM COM ERRO MSH|^~\\&|HIS|HOSPITAL|MIRTHBR|ENGINE|202312140800||ADT^A01|MSG00001|P|2.3\nEVN|A01|202312140800\nPID|||123456^^^HOSP^MR||SILVA^MARIA^LUIZA||19850315|F|||RUA DAS FLORES 123^^SAO PAULO^SP^01234567^BR||5511912345678\nPV1||I|UTI^101^A^HOSPITAL||||1234^ALMEIDA^CARLOS^EDUARDO^DR|||MED||||||||1234567890|||||||||||||202312140800",
        "color": "#fce7f3"
      },
      "width": 300,
      "height": 196,
      "selected": false,
      "positionAbsolute": {
        "x": 1273.6963529555155,
        "y": 464.7544534042331
      },
      "dragging": false
    },
    {
      "id": "node-1766009007768",
      "type": "commentNode",
      "position": {
        "x": 1283.0768573192493,
        "y": 677.4213777491668
      },
      "data": {
        "label": "Comment",
        "text": "MSH|^~\\&|HIS|HOSPITAL|MIRTHBR|ENGINE|202312140800||ADT^A01|MSG00001|P|2.3\nEVN|A01|202312140800\nPID|1||123456||SILVA^MARIA^LUIZA||19850315|F|||RUA DAS FLORES 123^^SAO PAULO^SP^01234567^BR||5511912345678\nPV1|1|I|UTI^101^A^HOSPITAL||||1234^ALMEIDA^CARLOS^EDUARDO^DR|||MED||||||||1234567890|||||||||||||202312140800",
        "color": "#d1fae5"
      },
      "width": 300,
      "height": 176,
      "selected": false,
      "positionAbsolute": {
        "x": 1283.0768573192493,
        "y": 677.4213777491668
      },
      "dragging": false
    }
  ],
  "edges": [
    {
      "id": "e1",
      "source": "source-http",
      "target": "proc-hl7-parser",
      "animated": true
    },
    {
      "id": "e2",
      "source": "proc-hl7-parser",
      "target": "proc-validator",
      "animated": true
    },
    {
      "id": "e3",
      "source": "proc-validator",
      "target": "proc-enrich",
      "animated": true
    },
    {
      "id": "e4",
      "source": "proc-enrich",
      "target": "dest-file",
      "animated": true
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008640939",
      "sourceHandle": null,
      "target": "node-1766008650622",
      "targetHandle": null,
      "id": "reactflow__edge-node-1766008640939-node-1766008650622"
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008694638",
      "sourceHandle": null,
      "target": "node-1766008613292",
      "targetHandle": null,
      "id": "reactflow__edge-node-1766008694638-node-1766008613292"
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008640939",
      "sourceHandle": null,
      "target": "node-1766008613292",
      "targetHandle": null,
      "id": "reactflow__edge-node-1766008640939-node-1766008613292"
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008694638",
      "sourceHandle": null,
      "target": "source-http",
      "targetHandle": "config-path",
      "id": "reactflow__edge-node-1766008694638-source-httpconfig-path"
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008613292",
      "sourceHandle": null,
      "target": "test-node",
      "targetHandle": "config-url",
      "id": "reactflow__edge-node-1766008613292-test-nodeconfig-url"
    },
    {
      "type": "smoothstep",
      "animated": true,
      "source": "node-1766008650622",
      "sourceHandle": null,
      "target": "source-http",
      "targetHandle": "config-port",
      "id": "reactflow__edge-node-1766008650622-source-httpconfig-port"
    }
  ],
  "exportedAt": "2025-12-17T22:06:45.416Z"
}